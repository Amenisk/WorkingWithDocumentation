@using WorkingWithDocumentation.Data
@inject NavigationManager Navigation
@inject ProjectService ProjectService

<table class="table table-bordered">
    <thead>
        <tr>
            <th scope="col" width="50%">Наименование</th>
            <th scope="col">Заполнение</th>
        </tr>
        <tr>
            <th colspan="2"><p style="text-align: center">Технико-экономические показатели (ТЭП)</p>
                <p style="text-align: center">Газопровод-ввод низкого давления</p>
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                Диаметр (мм) трубопровода и протяженность
                линейного объекта (м)
            </td>
            <td><input @bind-value="form.DiameterOfPipelineAndLengthOfObject1" style="width: 100%"></td>
        </tr>
        <tr>
            <td colspan="2">
                <p style="text-align: center">Вводной газопровод низкого давления</p>
            </td>
        </tr>
        <tr>
            <td>
                Диаметр (мм) трубопровода и протяженность
                линейного объекта (м)
            </td>
            <td><input @bind-value="form.DiameterOfPipelineAndLengthOfObject2" style="width: 100%"></td>
        </tr>
        <tr>
            <td>
                <strong>Сметная стоимость работ, тыс. руб.</strong>
            </td>
            <td><input @bind-value="form.EstimatedCostOfWork" style="width: 100%"></td>
        </tr>
        <tr>
            <td>
                Срок разработки проектной документации, месяцев
            </td>
            <td><input @bind-value="form.TermForDevelopment" style="width: 100%"></td>
        </tr>
    </tbody>
</table>
<br />

<button type="button" class="btn btn-primary" @onclick=ApproveForm>Утвердить форму</button>
<button type="button" class="btn btn-primary" @onclick=GoBack>Выйти</button>
@if(form.IsApproved)
{
    <input name="isImportant" type="checkbox" checked="checked" style="margin: 20px 20px 20px 20px" disabled/>
}
else
{
    <input name="isImportant" type="checkbox" style="margin: 20px 20px 20px 20px" disabled/>
}

@code {
    [Parameter]
    public Project Project { get; set; }

    GasSupplyForm form = new GasSupplyForm();

    protected override void OnInitialized()
    {
        base.OnInitialized();
        if(Project.GasSupply is not null)
        {
            form = Project.GasSupply.Clone();
        }   
    }

    private void ApproveForm()
    {
        form.IsApproved = true;
        ProjectService.SaveGasForm(form, Project.NumberOfProject);
        GoBack();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/documents");
    }
}
